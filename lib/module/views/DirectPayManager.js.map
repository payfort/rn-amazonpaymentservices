{"version":3,"names":["React","findNodeHandle","PixelRatio","Platform","requireNativeComponent","ScrollView","UIManager","Text","useEffect","useRef","RnAmazonPaymentServiceSdk","nativeResponseSelector","payButtonSelector","DIRECT_PAY_VIEW_HEIGHT","DIRECT_PAY_VIEW_WIDTH","ViewManager","DirectPayManager","props","onFailure","onSuccess","requestObject","environment","DEFAULT_STYLE","width","height","defaultStyle","style","propsDone","isIOS","OS","createFragment","viewId","dispatchViewManagerCommand","DirectPay","Commands","create","toString","returnSuccessParsed","response","responseObject","returnFailureParsed","ref","payButtonProps","setUpScreen","current","callDirectPayFortRequest","styleAndroid","getPixelSizeForLayoutSize","propsAdjustedAndroid","propsAdjustedIOS","setTimeout"],"sources":["DirectPayManager.tsx"],"sourcesContent":["import * as React from 'react';\nimport {\n  findNodeHandle,\n  PixelRatio,\n  Platform,\n  requireNativeComponent,\n  ScrollView,\n  UIManager,\n  Text,\n} from 'react-native';\nimport { useEffect, useRef } from 'react';\nimport RnAmazonPaymentServiceSdk from '../nativeModules/RnAmazonPaymentServiceSdk';\nimport nativeResponseSelector from '../utils/nativeResponseSelector';\nimport type { customCheckoutViewProps } from '../types/viewProps';\nimport payButtonSelector from '../utils/payButtonSelector';\nimport {\n  DIRECT_PAY_VIEW_HEIGHT,\n  DIRECT_PAY_VIEW_WIDTH,\n} from '../constants/styleDefaults';\n\nconst ViewManager = requireNativeComponent('DirectPay');\n\nconst DirectPayManager: React.FC<customCheckoutViewProps> = (props) => {\n  const {\n    onFailure = () => {},\n    onSuccess = () => {},\n    requestObject,\n    environment = 'TEST',\n  } = props;\n\n  const DEFAULT_STYLE = {\n    width: DIRECT_PAY_VIEW_WIDTH,\n    height: DIRECT_PAY_VIEW_HEIGHT,\n  };\n  const defaultStyle = props.style ? props.style : DEFAULT_STYLE;\n  const propsDone = requestObject;\n  const isIOS = Platform.OS === 'ios';\n\n  const createFragment = (viewId: any) =>\n    UIManager.dispatchViewManagerCommand(\n      viewId,\n      // we are calling the 'create' command\n      // @ts-ignore\n      UIManager.DirectPay.Commands.create.toString(),\n      [viewId]\n    );\n\n  const returnSuccessParsed = (response: any) => {\n    const responseObject = nativeResponseSelector(response);\n    if (onSuccess) {\n      onSuccess(responseObject);\n    }\n  };\n\n  const returnFailureParsed = (response: any) => {\n    const responseObject = nativeResponseSelector(response);\n    if (onFailure) {\n      onFailure(responseObject);\n    }\n  };\n\n  const ref = useRef(null);\n\n  const payButtonProps = payButtonSelector(props.payButtonProps);\n\n  const setUpScreen = () => {\n    const viewId = findNodeHandle(ref.current);\n    createFragment(viewId);\n    RnAmazonPaymentServiceSdk.callDirectPayFortRequest(\n      requestObject,\n      payButtonProps,\n      environment,\n      returnSuccessParsed,\n      returnFailureParsed\n    );\n  };\n\n  const styleAndroid = {\n    style: {\n      // @ts-ignore\n      height: PixelRatio.getPixelSizeForLayoutSize(defaultStyle?.height),\n      // @ts-ignore\n      width: PixelRatio.getPixelSizeForLayoutSize(defaultStyle?.width),\n    },\n  };\n\n  const propsAdjustedAndroid = {\n    ...props,\n    ...styleAndroid,\n  };\n\n  const propsAdjustedIOS = {\n    ...props,\n    payButtonProps,\n    onSuccess: returnSuccessParsed,\n    onFailure: returnFailureParsed,\n  };\n\n  useEffect(() => {\n    !isIOS && propsDone && setTimeout(() => setUpScreen(), 200);\n  }, [propsDone]);\n\n  return (\n    // @ts-ignore\n    <ScrollView\n      style={defaultStyle}\n      scrollEnabled={false}\n      showsVerticalScrollIndicator={false}\n    >\n      {propsDone ? (\n        <ViewManager\n          {...(isIOS ? propsAdjustedIOS : propsAdjustedAndroid)}\n          ref={ref}\n        />\n      ) : (\n        // @ts-ignore\n        <Text>Request object missing</Text>\n      )}\n    </ScrollView>\n  );\n};\n\nexport default DirectPayManager;\n"],"mappings":"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"}